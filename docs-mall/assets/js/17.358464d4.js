(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{260:function(t,a,s){"use strict";s.r(a);var n=s(28),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("blockquote",[s("p",[t._v("为了提升下用户体验，讲下项目中这个骨架屏的处理吧。")])]),t._v(" "),s("h3",{attrs:{id:"_1、骨架屏"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、骨架屏"}},[t._v("#")]),t._v(" 1、骨架屏")]),t._v(" "),s("ul",[s("li",[t._v("骨架屏就是可以由原来的在尚未加载前"),s("strong",[t._v("转圈圈")]),t._v("变成先给用户展示出"),s("strong",[t._v("页面的大致结构")]),t._v("，这样可以让用户有个更好的体验感。")]),t._v(" "),s("li",[t._v("把网速调低点，以我们的"),s("a",{attrs:{href:"https://github.com/Ewall1106/mall",target:"_blank",rel:"noopener noreferrer"}},[t._v("mall项目"),s("OutboundLink")],1),t._v("的首页加载为例：")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("前")]),t._v(" "),s("th",[t._v("后")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/2891127-9e27bf667db3462f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:""}})]),t._v(" "),s("td",[s("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/2891127-b49c57ba943f0a56.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:""}})])])])]),t._v(" "),s("h3",{attrs:{id:"_2、实现方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、实现方式"}},[t._v("#")]),t._v(" 2、实现方式")]),t._v(" "),s("p",[t._v("搜了下网上的教程，大概有这么几种方式："),s("br"),t._v("\n（1）使用图片")]),t._v(" "),s("ul",[s("li",[t._v("就是直接麻烦设计切张图片，控制这张图片的隐藏和显示。")])]),t._v(" "),s("p",[t._v("（2）饿了吗方案")]),t._v(" "),s("ul",[s("li",[t._v("第2种就是使用饿了吗的"),s("a",{attrs:{href:"https://github.com/ElemeFE/page-skeleton-webpack-plugin/blob/master/docs/i18n/zh_cn.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("page-skeleton-webpack-plugin"),s("OutboundLink")],1),t._v("这个插件。我在项目首页中用了一下，效果不太理想，不知道是不是首页的元素太多了。")]),t._v(" "),s("li",[t._v("它的配置还是比较简简单的的，但是项目很久没维护了，还是有坑，你可以按照这篇文章的步骤"),s("strong",[t._v("一步步")]),t._v("自己试一下"),s("a",{attrs:{href:"https://segmentfault.com/a/1190000020416483",target:"_blank",rel:"noopener noreferrer"}},[t._v("--\x3e参考"),s("OutboundLink")],1),t._v("。")])]),t._v(" "),s("p",[t._v("（3）ssr渲染")]),t._v(" "),s("ul",[s("li",[t._v("第三种方案就是一种ssr的思路，使用的是"),s("code",[t._v("vue-server-renderer")]),t._v("这个插件。")]),t._v(" "),s("li",[t._v("我们知道vue在渲染好后会挂载到指定的"),s("code",[t._v("#app")]),t._v("这个元素上，这个方案就是先生成一个骨架屏的样式文件，在"),s("code",[t._v("#app")]),t._v("中先占个位，达到在vue未挂载前有一个过渡效果。")])]),t._v(" "),s("div",{staticClass:"language-html line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!--vue-ssr-outlet--\x3e")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])]),s("div",{staticClass:"language-javascript line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// main.js")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Vue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  router"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  store"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("render")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("h")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("h")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("App"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("$mount")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'#app'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br")])]),s("ul",[s("li",[s("p",[s("a",{attrs:{href:"https://segmentfault.com/a/1190000014963269?utm_source=channel-hottest",target:"_blank",rel:"noopener noreferrer"}},[t._v("vue页面骨架屏"),s("OutboundLink")],1),t._v("这篇文章也讲的很清楚，我也是参考它试了一下，但是也是有问题。比如文章底部的这个提问：\n"),s("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/2891127-06169c81c8622f36.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:""}})])]),t._v(" "),s("li",[s("p",[t._v("我们的"),s("code",[t._v("vue")]),t._v("挂载到了"),s("code",[t._v("#app")]),t._v("上面的这个渲染时间不是我们要解决目的所在，只是因为网络问题数据迟迟没到所以造成页面不完整，所以需要骨架屏。不知道看到这里的看官对这个方案有没有什么好的解决办法。")])])]),t._v(" "),s("p",[t._v("（4）借助Puppeteer自动生成骨架屏")]),t._v(" "),s("ul",[s("li",[t._v("这个是利用chrome的"),s("a",{attrs:{href:"https://github.com/puppeteer/puppeteer",target:"_blank",rel:"noopener noreferrer"}},[t._v("puppeteer"),s("OutboundLink")],1),t._v("来获取页面的DOM结构，然后来生成骨架屏。考拉就是利用的这个方案，"),s("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/114362353",target:"_blank",rel:"noopener noreferrer"}},[t._v("--\x3e详见"),s("OutboundLink")],1),t._v("。")]),t._v(" "),s("li",[t._v("当你看完了以后，你就会发现最后也是生成一张"),s("code",[t._v("base64")]),t._v("为的图片做替换而已，还挺麻烦的，再个是puppeteer我不会啊。")])]),t._v(" "),s("p",[t._v("（5）vue-content-loader库")]),t._v(" "),s("ul",[s("li",[t._v("最后，我们"),s("a",{attrs:{href:"https://github.com/Ewall1106/mall",target:"_blank",rel:"noopener noreferrer"}},[t._v("mall"),s("OutboundLink")],1),t._v("项目中还是使用了这个比较简单直接的方案。第"),s("code",[t._v("5")]),t._v("种其实就是第1种的衍生，使用"),s("a",{attrs:{href:"https://github.com/egoist/vue-content-loader",target:"_blank",rel:"noopener noreferrer"}},[t._v("vue-content-loader"),s("OutboundLink")],1),t._v("这个插件自己按照设计稿画出一个大致的"),s("code",[t._v("svg")]),t._v("图，然后控制其显示隐藏。")])]),t._v(" "),s("h3",{attrs:{id:"_3、具体实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3、具体实现"}},[t._v("#")]),t._v(" 3、具体实现")]),t._v(" "),s("ul",[s("li",[t._v("先安装下这个吧：")])]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("$ sudo npm install vue-content-loader -S\n\n# 切换镜像以后还是报错？\n$ sudo npm install --unsafe-perm vue-content-loader -S\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])]),s("ul",[s("li",[t._v("以首页为例，你可以参考设计稿把大概的轮廓画出就可以了。"),s("a",{attrs:{href:"https://github.com/Ewall1106/mall/blob/master/src/views/home/modules/Skeleton.vue",target:"_blank",rel:"noopener noreferrer"}},[t._v("--\x3eSkeleton.vue"),s("OutboundLink")],1)]),t._v(" "),s("li",[t._v("然后讲下如何控制它的显示与隐藏达到最好的一个首屏展示效果。")])]),t._v(" "),s("h3",{attrs:{id:"_4、首屏渲染"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4、首屏渲染"}},[t._v("#")]),t._v(" 4、首屏渲染")]),t._v(" "),s("ul",[s("li",[t._v("以我们项目中的"),s("a",{attrs:{href:"https://github.com/Ewall1106/mall/blob/master/src/views/home/index.vue",target:"_blank",rel:"noopener noreferrer"}},[t._v("首页"),s("OutboundLink")],1),t._v("的为例，一共有从上到下一共四个区域："),s("code",[t._v("轮播图")]),t._v("、"),s("code",[t._v("金刚区")]),t._v("、"),s("code",[t._v("精选会场")]),t._v("、"),s("code",[t._v("推荐列表")]),t._v("。")]),t._v(" "),s("li",[t._v("由于前三个区域是用户直接可见的，所以前三项的数据请求优先于最后一项，所以我们使用"),s("code",[t._v("promise")]),t._v("保证一下优先级以及骨架屏的隐藏显示。")])]),t._v(" "),s("div",{staticClass:"language-javascript line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mounted")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    Promise"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("all")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getBanner")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getCategory")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getSession")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("isSkeletonShow "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getGoodsList")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br")])]),s("ul",[s("li",[t._v("使用"),s("code",[t._v("preloading")]),t._v("加载将首页路由的优先级提高一下：")])]),t._v(" "),s("div",{staticClass:"language-javascript line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" routes "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Home'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("component")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* webpackPreload: true */")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@/views/home'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br")])]),s("ul",[s("li",[t._v("最后我们把接口返回数据的时间delay，网速调低，刷新首页后看到其实效果还可以：\n"),s("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/2891127-916cc1867715557e.gif?imageMogr2/auto-orient/strip",alt:"骨架屏效果"}})])]),t._v(" "),s("h3",{attrs:{id:"_5、小结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5、小结"}},[t._v("#")]),t._v(" 5、小结")]),t._v(" "),s("ul",[s("li",[t._v("综上所述，目前我能想到的骨架屏解决方案就是这样的了，"),s("code",[t._v("mall")]),t._v("项目中也是这样写的，麻烦的地方就是需要骨架屏的页面都需要自己去定位然后写下骨架屏，不够自动化，但是我觉得也还好吧，其实一个项目中几个主要的页面走下骨架屏就行了，并不需要每个页面都骨架屏。")]),t._v(" "),s("li",[t._v("但是不管怎样，这都是我的一种解决方案吧，不够自动化确实是它的缺点，但从结果上和产出投入比来看，我觉得可以。")])]),t._v(" "),s("p",[t._v("参考链接："),s("br"),t._v(" "),s("a",{attrs:{href:"https://github.com/egoist/vue-content-loader",target:"_blank",rel:"noopener noreferrer"}},[t._v("vue-content-loader"),s("OutboundLink")],1),s("br"),t._v(" "),s("a",{attrs:{href:"https://github.com/ElemeFE/page-skeleton-webpack-plugin/blob/master/docs/i18n/zh_cn.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("page-skeleton-webpack-plugin"),s("OutboundLink")],1),s("br"),t._v(" "),s("a",{attrs:{href:"https://github.com/egoist/vue-content-loader",target:"_blank",rel:"noopener noreferrer"}},[t._v("vue-content-loader"),s("OutboundLink")],1),s("br"),t._v(" "),s("a",{attrs:{href:"https://segmentfault.com/a/1190000014963269?utm_source=channel-hottest",target:"_blank",rel:"noopener noreferrer"}},[t._v("vue页面骨架屏"),s("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=e.exports}}]);